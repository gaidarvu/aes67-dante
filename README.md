# Установка aes67-daemon

## Создание VLAN

Необходимо на коммутаторе создать отдельный VLAN "AUDIO" для multicast траффика звуковых источников, а так же настроить qos на портах входящих в вышеуказанный VLAN.

Интерфейсы, которые будут подключены к звуковому оборудованию (матрицы и данте контроллеры) включаются в "AUDIO" в ACCESS состоянии.

Интерфейсы, которые подключаются к мини-ПК с установленными демонами AES, находятся либо в состоянии TRUNK, либо в состоянии GENERAL с тэгированием трафика VLAN "AUDIO".

## Что делает роль:

- Опрашивает  ansible_facts и заполняет теплейт [text](template/00-installer-config.yaml.j2) для netplan. По факту в netplan только добавляется vlan "AUDIO".

Для герсов темплейт немного другой [text](template/00-installer-config.yaml.gers.j2)

- Удаляет пакеты pulseaudio с зависимостями и путями из папки home

- Устанавливает пакет aes67-daemon v1.6.5-1 и подкидывает нужные конфиги из темплейтов

- Создаёт override для службы Lyra, который связывает зависимостью Lyra и aes67 и добавляет отсрочку старта службы Lyra 20 сек.

- Добавляет в sysctl.conf сетевые параметры и параметры ядра для aes67

- В роли стоят handlers на рестарт службы и рестарт системы

После раскатки роли инженеры настраивают коммутатор Dante и направляют звук по нужным портам