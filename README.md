# Установка aes67-daemon

Установка aes67-daemon производится из репозитория common-deb

## Создание VLAN

Необходимо на коммутаторе создать отдельный VLAN "AUDIO" для multicast траффика звуковых источников, а так же настроить qos на портах входящих в вышеуказанный VLAN.

Интерфейсы, которые будут подключены к звуковому оборудованию (матрицы и данте контроллеры) включаются в "AUDIO" в ACCESS состоянии.

Интерфейсы, которые подключаются к мини-ПК с установленными демонами AES, находятся либо в состоянии TRUNK, либо в состоянии GENERAL с тэгированием трафика VLAN "AUDIO".

## Что делает роль:

- Опрашивает  ansible_facts и заполняет [темплейт](template/00-installer-config.yaml.j2) для netplan. По факту в netplan только добавляется vlan "AUDIO".

Для герсов [темплейт](template/00-installer-config.yaml.gers.j2) немного другой

- Удаляет пакеты pulseaudio с зависимостями и путями из папки home

- Устанавливает пакет aes67-daemon v1.6.5-1 и подкидывает нужные конфиги из темплейтов для [демона](template/daemon.conf.j2) и для [соурса](template/status.json.j2). Конфиг для синка надо создавать вручную

- Создаёт [override](template/override.conf.j2) для службы Lyra, который связывает зависимостью Lyra и aes67 и добавляет отсрочку старта службы Lyra 20 сек.

- Добавляет в sysctl.conf сетевые параметры и параметры ядра для aes67
<!-- 
Общая пропускная способность, доступная для всех задач реального времени, на 100% от ЦП (1000000)

Отключение событий масштабирования CPU (0)

Максимальный размер буфера отправки (wmem) ОС (12582912)

Размер буфера приёма (rmem) равным 12 МБ для очередей по всем протоколам (12582912)

Минимальный размер, начальный размер и максимальный размер в байтах (10240 87380 12582912)

Масштабирование окна, которое может быть опцией увеличения окна передачи (1)

Отметки времени, как определено в RFC1323 (1)

Максимальное количество пакетов, помещаемых в очередь на стороне INPUT, когда интерфейс получает пакеты быстрее, чем ядро может их обработать (5000)
-->

- В роли стоят handlers на рестарт службы и рестарт системы

## Инженеры

После раскатки роли инженеры настраивают коммутатор Dante и направляют звук по нужным портам

Далее на герсах, конференции и инфотабло нужно вручную создать sink и выбрать в нем нужный мультикаст, который создадут инженеры на dante коммутаторе.

После этого можно тестировать звук.